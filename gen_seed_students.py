# -*- coding: utf-8 -*-
"""Генерация seed_students.sql: 20 человек на каждый класс 1А–11Г."""
import os

FIRSTS_M = (
    'Александр', 'Дмитрий', 'Максим', 'Иван', 'Артём', 'Никита', 'Михаил', 'Даниил', 'Егор', 'Кирилл',
    'Илья', 'Алексей', 'Роман', 'Сергей', 'Андрей', 'Владимир', 'Павел', 'Николай', 'Евгений', 'Денис',
)
FIRSTS_F = (
    'Мария', 'Анна', 'Елена', 'Ольга', 'Виктория', 'Дарья', 'Полина', 'Алиса', 'Ксения', 'Наталья',
    'Татьяна', 'Екатерина', 'Анастасия', 'София', 'Александра', 'Елизавета', 'Ульяна', 'Варвара', 'Валерия', 'Вероника',
)
LASTS = (
    'Иванов', 'Петрова', 'Сидоров', 'Козлова', 'Новиков', 'Морозова', 'Волков', 'Соколова', 'Лебедев', 'Кузнецова',
    'Попов', 'Федорова', 'Михайлов', 'Андреева', 'Зайцев', 'Семёнова', 'Егоров', 'Павлова', 'Голубев', 'Виноградова',
    'Богданов', 'Воробьёв', 'Фролова', 'Лазарев', 'Медведева', 'Белов', 'Александрова', 'Герасимов', 'Степанова', 'Николаев',
    'Орлова', 'Киселёв', 'Макарова', 'Захаров', 'Соловьёва', 'Борисов', 'Яковлева', 'Григорьев', 'Романова', 'Владимиров',
    'Сергеева', 'Филиппов', 'Дмитриева', 'Королёв', 'Алексеева', 'Тихонов', 'Крылова', 'Максимов', 'Беляева', 'Коновалов',
    'Ефимова', 'Тарасов', 'Власова', 'Миронов', 'Кузьмина', 'Калинин', 'Шарова', 'Носов', 'Симонова', 'Фомичёв',
    'Данилова', 'Русаков', 'Суханова', 'Родионов', 'Одинцова', 'Цветков', 'Блинова', 'Марков', 'Воронова', 'Абрамов',
    'Мартынова', 'Ершов', 'Гусева', 'Тимофеев', 'Калашникова', 'Князев', 'Носков', 'Жуков', 'Воронцова', 'Пономарёв',
    'Рябов', 'Сорокина', 'Мамонтов', 'Шестакова', 'Голубев', 'Лазарева', 'Кудрявцев', 'Баранов', 'Зимина', 'Комиссаров',
    'Корнеева', 'Гаврилов', 'Архипова', 'Кононов', 'Терентьева', 'Рогов', 'Соболева', 'Копылова', 'Мельников', 'Пахомова',
)
# Чередуем мужские/женские фамилии по окончанию
def last_name(i, male):
    n = LASTS[i % len(LASTS)]
    if male and n.endswith('а') and n not in ('Сорокина', 'Шестакова', 'Воронцова', 'Пономарёв', 'Корнеева', 'Терентьева', 'Копылова', 'Пахомова'):
        return n[:-1] if n != 'Николаев' else n  # упрощённо: берём как есть или убираем а
    return n

CLASSES = []
for g in range(1, 12):
    for l in 'АБВГ':
        CLASSES.append((f'{g}{l}', 2017 - g + 1))  # год рождения: 1кл=2017, 11кл=2007

out = []
out.append("-- Заполнение таблицы students: по 20 человек на класс (1А–11Г).")
out.append("-- Выполнить в базе, где есть таблицы classrooms и students (например Diplom).")
out.append("")

idx = 0
for class_name, year in CLASSES:
    out.append(f"-- {class_name} ({year})")
    out.append("INSERT INTO students (first_name, last_name, class_id, birth_date)")
    out.append("SELECT v.fn, v.ln, c.id, v.bd::date")
    out.append("FROM (VALUES")
    values = []
    for i in range(20):
        male = i % 2 == 0
        first = FIRSTS_M[i % len(FIRSTS_M)] if male else FIRSTS_F[i % len(FIRSTS_F)]
        last = LASTS[(idx + i) % len(LASTS)]
        month = (i % 12) + 1
        day = (i % 28) + 1
        date_str = f"{year}-{month:02d}-{day:02d}"
        first_esc = first.replace("'", "''")
        last_esc = last.replace("'", "''")
        values.append(f"  ('{first_esc}', '{last_esc}', '{date_str}'::date)")
    out.append(",\n".join(values))
    out.append(") AS v(fn, ln, bd)")
    out.append(f"CROSS JOIN (SELECT id FROM classrooms WHERE name = '{class_name}' LIMIT 1) c;")
    out.append("")
    idx += 20

path = os.path.join(os.path.dirname(__file__), 'seed_students.sql')
with open(path, 'w', encoding='utf-8') as f:
    f.write("\n".join(out))
print(f"Written {path}, {len(CLASSES)} classes, {len(CLASSES) * 20} students")
